<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nuchistrike</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px;
      font-family: sans-serif;
      z-index: 1;
    }
    canvas { display: block; cursor: none; }
  </style>
</head>
<body>
  <div id="info">Weight: 1.00 lbs | HP: 100%</div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(10, 10, 10);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0xffffff, 0.3));

    scene.background = new THREE.Color(0x1c1c1c);

    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(200, 200),
      new THREE.MeshStandardMaterial({ color: 0x666666 })
    );
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    const cat = new THREE.Mesh(
      new THREE.SphereGeometry(1, 32, 32),
      new THREE.MeshStandardMaterial({ color: 0xffcc99 })
    );
    cat.position.y = 1;
    scene.add(cat);

    const info = document.getElementById("info");
    let weight = 1.0;
    let hp = 100;
    const foodItems = [];

    // Simulated food: different shapes & weights
    function spawnFood() {
      const types = [
        { geometry: new THREE.SphereGeometry(0.2), weight: 0.1, color: 0x996633 }, // Kibble
        { geometry: new THREE.BoxGeometry(0.3, 0.3, 0.3), weight: 0.25, color: 0xdddddd }, // Tuna can
        { geometry: new THREE.BoxGeometry(0.4, 0.2, 0.6), weight: 0.5, color: 0x3366ff }  // Fish bag
      ];
      const type = types[Math.floor(Math.random() * types.length)];
      const mat = new THREE.MeshStandardMaterial({ color: type.color });
      const food = new THREE.Mesh(type.geometry, mat);
      food.userData.weight = type.weight;
      food.position.set((Math.random() - 0.5) * 180, 0.15, (Math.random() - 0.5) * 180);
      scene.add(food);
      foodItems.push(food);
    }
    for (let i = 0; i < 30; i++) spawnFood();

    // Pointer lock for camera control
    let isPointerLocked = false;
    document.body.addEventListener("click", () => {
      if (!isPointerLocked) {
        renderer.domElement.requestPointerLock();
      }
    });
    document.addEventListener("pointerlockchange", () => {
      isPointerLocked = document.pointerLockElement === renderer.domElement;
    });

    let move = { forward: false, backward: false, left: false, right: false, shift: false };
    document.addEventListener("keydown", (e) => {
      if (e.key === "w") move.forward = true;
      if (e.key === "s") move.backward = true;
      if (e.key === "a") move.left = true;
      if (e.key === "d") move.right = true;
      if (e.key === "Shift") move.shift = true;
    });
    document.addEventListener("keyup", (e) => {
      if (e.key === "w") move.forward = false;
      if (e.key === "s") move.backward = false;
      if (e.key === "a") move.left = false;
      if (e.key === "d") move.right = false;
      if (e.key === "Shift") move.shift = false;
    });

    let yaw = 0;
    document.addEventListener("mousemove", (e) => {
      if (isPointerLocked) yaw -= e.movementX * 0.002;
    });

    function animate() {
      requestAnimationFrame(animate);

      let moveSpeed = move.shift ? 0.25 : 0.15;
      moveSpeed -= weight * 0.0025;
      moveSpeed = Math.max(0.05, moveSpeed);

      const dir = new THREE.Vector3();
      dir.set(Math.sin(yaw), 0, Math.cos(yaw));

      if (move.forward) cat.position.add(dir.clone().multiplyScalar(moveSpeed));
      if (move.backward) cat.position.add(dir.clone().multiplyScalar(-moveSpeed));

      const sideDir = new THREE.Vector3().crossVectors(new THREE.Vector3(0, 1, 0), dir);
      if (move.left) cat.position.add(sideDir.clone().multiplyScalar(moveSpeed));
      if (move.right) cat.position.add(sideDir.clone().multiplyScalar(-moveSpeed));

      camera.position.copy(cat.position.clone().add(new THREE.Vector3(0, 5, 8).applyAxisAngle(new THREE.Vector3(0,1,0), yaw)));
      camera.lookAt(cat.position);

      for (let i = foodItems.length - 1; i >= 0; i--) {
        const f = foodItems[i];
        if (cat.position.distanceTo(f.position) < 1 + weight * 0.05) {
          scene.remove(f);
          foodItems.splice(i, 1);
          const gain = f.userData.weight * (100 / weight);
          weight += gain;
          cat.scale.set(weight * 0.1, weight * 0.1, weight * 0.1);
          info.textContent = `Weight: ${weight.toFixed(2)} lbs | HP: ${hp}%`;
          spawnFood();
        }
      }

      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
